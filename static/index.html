<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Arvo' rel='stylesheet'>
  <title>Video Color Palette Generator</title>
</head>


<body>
  <h1>Spirited Away Color Journey</h1>

  <svg id="plot" width="1270" height="170"></svg>

  <div id="frame-detail">
    <img id="frame-img" src="images/-1.jpg"
      alt="Interaction Instructions: View more details about a frame by hovering or clicking on a vertical bar above."
      width="700" height="376">
    <div id="frame-info">
      <svg id="frame-color-palette" width="520" height="120"></svg>
      <h2 id="frame-time">Time: n/a</h2>
    </div>
  </div>


  <script>
    /* ---------------- Plot ---------------- */
    const svg_plot = d3.select("#plot");
    const width_plot = svg_plot.attr("width");
    const height_plot = svg_plot.attr("height");
    const margin_plot = { top: 10, right: 10, bottom: 10, left: 10 };
    const plot_width = width_plot - margin_plot.left - margin_plot.right;
    const plot_height = height_plot - margin_plot.top - margin_plot.bottom;

    const annotations_plot = svg_plot.append("g").attr("id", "annotations_plot");

    const plot = svg_plot.append("g")
      .attr("transform", "translate(" + margin_plot.left + "," + margin_plot.top + ")");
    /* ---------------- Plot ---------------- */

    /* ---------------- Frame Image ---------------- */
    const frame_img = document.getElementById("frame-img");
    let lock_frame = -1;
    let lock_border;
    /* ---------------- Frame Image ---------------- */

    /* ---------------- Frame Info ---------------- */
    const svg_frame = d3.select("#plot");
    const width_frame = svg_plot.attr("width");
    const height_frame = svg_plot.attr("height");
    const margin_frame = { top: 10, right: 10, bottom: 10, left: 10 };
    const frame_width = width_frame - margin_frame.left - margin_frame.right;
    const frame_height = height_frame - margin_frame.top - margin_frame.bottom;

    const annotations_frame = svg_plot.append("g").attr("id", "annotations_frame");

    const frame = svg_frame.append("g")
      .attr("transform", "translate(" + margin_frame.left + "," + margin_frame.top + ")");
    /* ---------------- Frame Info ---------------- */

    const requestData = async function () {
      data = await d3.csv("data/color_palette.csv");
      console.log(data);

      data.forEach(d => {
        d['id'] = parseInt(d['id']);
      });

      let color_1 = plot.selectAll("color_1").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_1")
        .attr("opacity", 1)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 0)
        .attr("width", 10)
        .attr("height", 25)
        .attr("fill", d => d["color_1"]);

      let color_2 = plot.selectAll("color_2").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_2")
        .attr("opacity", 1)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 25)
        .attr("width", 10)
        .attr("height", 25)
        .attr("fill", d => d["color_2"]);

      let color_3 = plot.selectAll("color_3").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_3")
        .attr("opacity", 1)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 50)
        .attr("width", 10)
        .attr("height", 25)
        .attr("fill", d => d["color_3"]);

      let color_4 = plot.selectAll("color_4").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_4")
        .attr("opacity", 1)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 75)
        .attr("width", 10)
        .attr("height", 25)
        .attr("fill", d => d["color_4"]);

      let color_5 = plot.selectAll("color_5").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_5")
        .attr("opacity", 1)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 100)
        .attr("width", 10)
        .attr("height", 25)
        .attr("fill", d => d["color_5"]);

      let color_border = plot.selectAll("color_border").data(data)
        .enter()
        .append("rect")
        .attr("class", "color_border")
        .attr("opacity", 1)
        .attr("fill-opacity", 0)
        .attr("x", d => d["id"] * 10)
        .attr("y", d => 0)
        .attr("width", 10)
        .attr("height", 125)
        .attr("stroke", d => "white")
        .on('click', function (d, i) {
          let id = d3.select(this).data()[0]["id"]
          lock_frame = lock_frame === id ? -1 : id
          frame_img.setAttribute('src', "images/" + lock_frame + ".jpg");
        })
        .on('mouseover', function (d, i) {
          d3.select(this)
            .transition()
            .attr("x", d => d["id"] * 10 - 1)
            .attr('stroke-width', 2)
            .attr('width', 12)
            .attr("stroke", "white");
        })

        .on('mouseout', function (d, i) {
          d3.select(this)
            .transition()
            .attr("x", d => d["id"] * 10)
            .attr('stroke-width', 1)
            .attr('width', 10)
            .attr("stroke", "white");
        })
    };


    requestData();
  </script>

</body>

<style>
  body {
    font-family: 'Arvo', sans-serif;
  }

  svg {
    background-color: rgb(230, 215, 215);
  }

  #frame-detail {
    display: flex;
    flex-direction: row;
  }

  #frame-info {
    margin-left: 10px;
  }
</style>

</html>